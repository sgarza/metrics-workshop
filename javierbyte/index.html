<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Data Azendal</title>
  <link href="c3.css" rel="stylesheet" type="text/css">

</head>
<body>

<div id="chart"></div>

<script src="d3.min.js" charset="utf-8"></script>
<script src="c3.min.js"></script>
<script>
  var data = [
  {"started":"2015-07-11T00:00:00.000Z","estimated":"2015-07-16T00:00:00.000Z","delivered":"2015-07-21T00:00:00.000Z"},
  {"started":"2015-07-21T00:00:00.000Z","estimated":"2015-07-25T00:00:00.000Z","delivered":"2015-07-26T00:00:00.000Z"},
  {"started":"2015-07-26T00:00:00.000Z","estimated":"2015-08-01T00:00:00.000Z","delivered":"2015-08-07T00:00:00.000Z"},
  {"started":"2015-08-07T00:00:00.000Z","estimated":"2015-08-11T00:00:00.000Z","delivered":"2015-08-13T00:00:00.000Z"},
  {"started":"2015-08-13T00:00:00.000Z","estimated":"2015-08-17T00:00:00.000Z","delivered":"2015-08-18T00:00:00.000Z"},
  {"started":"2015-08-18T00:00:00.000Z","estimated":"2015-08-23T00:00:00.000Z","delivered":"2015-08-27T00:00:00.000Z"},
  {"started":"2015-08-27T00:00:00.000Z","estimated":"2015-08-30T00:00:00.000Z","delivered":"2015-09-01T00:00:00.000Z"},
  {"started":"2015-09-01T00:00:00.000Z","estimated":"2015-09-07T00:00:00.000Z","delivered":"2015-09-07T00:00:00.000Z"},
  {"started":"2015-09-07T00:00:00.000Z","estimated":"2015-09-12T00:00:00.000Z","delivered":"2015-09-12T00:00:00.000Z"},
  {"started":"2015-09-12T00:00:00.000Z","estimated":"2015-09-16T00:00:00.000Z","delivered":"2015-09-16T00:00:00.000Z"},
  {"started":"2015-09-16T00:00:00.000Z","estimated":"2015-09-21T00:00:00.000Z","delivered":"2015-09-21T00:00:00.000Z"},
  {"started":"2015-09-21T00:00:00.000Z","estimated":"2015-09-24T00:00:00.000Z","delivered":"2015-09-27T00:00:00.000Z"},
  {"started":"2015-09-27T00:00:00.000Z","estimated":"2015-10-04T00:00:00.000Z","delivered":"2015-10-06T00:00:00.000Z"},
  {"started":"2015-10-06T00:00:00.000Z","estimated":"2015-10-13T00:00:00.000Z","delivered":"2015-10-17T00:00:00.000Z"},
  {"started":"2015-10-17T00:00:00.000Z","estimated":"2015-10-21T00:00:00.000Z","delivered":"2015-10-25T00:00:00.000Z"},
  {"started":"2015-10-25T00:00:00.000Z","estimated":"2015-10-30T00:00:00.000Z","delivered":"2015-11-01T00:00:00.000Z"},
  {"started":"2015-11-01T00:00:00.000Z","estimated":"2015-11-08T00:00:00.000Z","delivered":"2015-11-12T00:00:00.000Z"},
  {"started":"2015-11-12T00:00:00.000Z","estimated":"2015-11-17T00:00:00.000Z","delivered":"2015-11-20T00:00:00.000Z"},
  {"started":"2015-11-20T00:00:00.000Z","estimated":"2015-11-26T00:00:00.000Z","delivered":"2015-11-29T00:00:00.000Z"},
  {"started":"2015-11-29T00:00:00.000Z","estimated":"2015-12-06T00:00:00.000Z","delivered":"2015-12-10T00:00:00.000Z"},
  {"started":"2015-12-10T00:00:00.000Z","estimated":"2015-12-14T00:00:00.000Z","delivered":"2015-12-15T00:00:00.000Z"},
  {"started":"2015-12-15T00:00:00.000Z","estimated":"2015-12-18T00:00:00.000Z","delivered":"2015-12-18T00:00:00.000Z"},
  {"started":"2015-12-18T00:00:00.000Z","estimated":"2015-12-24T00:00:00.000Z","delivered":"2015-12-30T00:00:00.000Z"},
  {"started":"2015-12-30T00:00:00.000Z","estimated":"2016-01-02T00:00:00.000Z","delivered":"2016-01-04T00:00:00.000Z"},
  {"started":"2016-01-04T00:00:00.000Z","estimated":"2016-01-10T00:00:00.000Z","delivered":"2016-01-15T00:00:00.000Z"},
  {"started":"2016-01-15T00:00:00.000Z","estimated":"2016-01-19T00:00:00.000Z","delivered":"2016-01-21T00:00:00.000Z"},
  {"started":"2016-01-21T00:00:00.000Z","estimated":"2016-01-28T00:00:00.000Z","delivered":"2016-02-02T00:00:00.000Z"},
  {"started":"2016-02-02T00:00:00.000Z","estimated":"2016-02-07T00:00:00.000Z","delivered":"2016-02-10T00:00:00.000Z"},
  {"started":"2016-02-10T00:00:00.000Z","estimated":"2016-02-16T00:00:00.000Z","delivered":"2016-02-17T00:00:00.000Z"},
  {"started":"2016-02-17T00:00:00.000Z","estimated":"2016-02-20T00:00:00.000Z","delivered":"2016-02-22T00:00:00.000Z"},
  {"started":"2016-02-22T00:00:00.000Z","estimated":"2016-02-28T00:00:00.000Z","delivered":"2016-03-03T00:00:00.000Z"},
  {"started":"2016-03-03T00:00:00.000Z","estimated":"2016-03-07T00:00:00.000Z","delivered":"2016-03-07T00:00:00.000Z"},
  {"started":"2016-03-07T00:00:00.000Z","estimated":"2016-03-14T00:00:00.000Z","delivered":"2016-03-20T00:00:00.000Z"},
  {"started":"2016-03-20T00:00:00.000Z","estimated":"2016-03-27T00:00:00.000Z","delivered":"2016-04-01T00:00:00.000Z"},
  {"started":"2016-04-01T00:00:00.000Z","estimated":"2016-04-04T00:00:00.000Z","delivered":"2016-04-06T00:00:00.000Z"},
  {"started":"2016-04-06T00:00:00.000Z","estimated":"2016-04-12T00:00:00.000Z","delivered":"2016-04-17T00:00:00.000Z"},
  {"started":"2016-04-17T00:00:00.000Z","estimated":"2016-04-21T00:00:00.000Z","delivered":"2016-04-22T00:00:00.000Z"},
  {"started":"2016-04-22T00:00:00.000Z","estimated":"2016-04-28T00:00:00.000Z","delivered":"2016-04-29T00:00:00.000Z"},
  {"started":"2016-04-29T00:00:00.000Z","estimated":"2016-05-03T00:00:00.000Z","delivered":"2016-05-03T00:00:00.000Z"},
  {"started":"2016-05-03T00:00:00.000Z","estimated":"2016-05-10T00:00:00.000Z","delivered":"2016-05-13T00:00:00.000Z"},
  {"started":"2016-05-13T00:00:00.000Z","estimated":"2016-05-17T00:00:00.000Z","delivered":"2016-05-20T00:00:00.000Z"},
  {"started":"2016-05-20T00:00:00.000Z","estimated":"2016-05-25T00:00:00.000Z","delivered":"2016-05-28T00:00:00.000Z"},
  {"started":"2016-05-28T00:00:00.000Z","estimated":"2016-06-02T00:00:00.000Z","delivered":"2016-06-03T00:00:00.000Z"},
  {"started":"2016-06-03T00:00:00.000Z","estimated":"2016-06-08T00:00:00.000Z","delivered":"2016-06-09T00:00:00.000Z"},
  {"started":"2016-06-09T00:00:00.000Z","estimated":"2016-06-16T00:00:00.000Z","delivered":"2016-06-16T00:00:00.000Z"},
  {"started":"2016-06-16T00:00:00.000Z","estimated":"2016-06-21T00:00:00.000Z","delivered":"2016-06-21T00:00:00.000Z"},
  {"started":"2016-06-21T00:00:00.000Z","estimated":"2016-06-24T00:00:00.000Z","delivered":"2016-06-26T00:00:00.000Z"},
  {"started":"2016-06-26T00:00:00.000Z","estimated":"2016-07-02T00:00:00.000Z","delivered":"2016-07-06T00:00:00.000Z"},
  {"started":"2016-07-06T00:00:00.000Z","estimated":"2016-07-12T00:00:00.000Z","delivered":"2016-07-16T00:00:00.000Z"},
  {"started":"2016-07-16T00:00:00.000Z","estimated":"2016-07-23T00:00:00.000Z","delivered":"2016-07-23T00:00:00.000Z"},
  {"started":"2016-07-23T00:00:00.000Z","estimated":"2016-07-28T00:00:00.000Z","delivered":"2016-08-02T00:00:00.000Z"},
  {"started":"2016-08-02T00:00:00.000Z","estimated":"2016-08-06T00:00:00.000Z","delivered":"2016-08-09T00:00:00.000Z"},
  {"started":"2016-08-09T00:00:00.000Z","estimated":"2016-08-16T00:00:00.000Z","delivered":"2016-08-20T00:00:00.000Z"},
  {"started":"2016-08-20T00:00:00.000Z","estimated":"2016-08-24T00:00:00.000Z","delivered":"2016-08-28T00:00:00.000Z"},
  {"started":"2016-08-28T00:00:00.000Z","estimated":"2016-08-31T00:00:00.000Z","delivered":"2016-09-01T00:00:00.000Z"},
  {"started":"2016-09-01T00:00:00.000Z","estimated":"2016-09-05T00:00:00.000Z","delivered":"2016-09-05T00:00:00.000Z"},
  {"started":"2016-09-05T00:00:00.000Z","estimated":"2016-09-10T00:00:00.000Z","delivered":"2016-09-14T00:00:00.000Z"},
  {"started":"2016-09-14T00:00:00.000Z","estimated":"2016-09-21T00:00:00.000Z","delivered":"2016-09-22T00:00:00.000Z"},
  {"started":"2016-09-22T00:00:00.000Z","estimated":"2016-09-27T00:00:00.000Z","delivered":"2016-09-30T00:00:00.000Z"},
  {"started":"2016-09-30T00:00:00.000Z","estimated":"2016-10-07T00:00:00.000Z","delivered":"2016-10-13T00:00:00.000Z"},
  {"started":"2016-10-13T00:00:00.000Z","estimated":"2016-10-19T00:00:00.000Z","delivered":"2016-10-20T00:00:00.000Z"},
  {"started":"2016-10-20T00:00:00.000Z","estimated":"2016-10-26T00:00:00.000Z","delivered":"2016-10-30T00:00:00.000Z"},
  {"started":"2016-10-30T00:00:00.000Z","estimated":"2016-11-04T00:00:00.000Z","delivered":"2016-11-06T00:00:00.000Z"},
  {"started":"2016-11-06T00:00:00.000Z","estimated":"2016-11-13T00:00:00.000Z","delivered":"2016-11-18T00:00:00.000Z"},
  {"started":"2016-11-18T00:00:00.000Z","estimated":"2016-11-25T00:00:00.000Z","delivered":"2016-11-28T00:00:00.000Z"},
  {"started":"2016-11-28T00:00:00.000Z","estimated":"2016-12-05T00:00:00.000Z","delivered":"2016-12-09T00:00:00.000Z"},
  {"started":"2016-12-09T00:00:00.000Z","estimated":"2016-12-16T00:00:00.000Z","delivered":"2016-12-16T00:00:00.000Z"},
  {"started":"2016-12-16T00:00:00.000Z","estimated":"2016-12-22T00:00:00.000Z","delivered":"2016-12-23T00:00:00.000Z"},
  {"started":"2016-12-23T00:00:00.000Z","estimated":"2016-12-30T00:00:00.000Z","delivered":"2017-01-05T00:00:00.000Z"},
  {"started":"2017-01-05T00:00:00.000Z","estimated":"2017-01-11T00:00:00.000Z","delivered":"2017-01-12T00:00:00.000Z"},
  {"started":"2017-01-12T00:00:00.000Z","estimated":"2017-01-15T00:00:00.000Z","delivered":"2017-01-16T00:00:00.000Z"},
  {"started":"2017-01-16T00:00:00.000Z","estimated":"2017-01-22T00:00:00.000Z","delivered":"2017-01-24T00:00:00.000Z"},
  {"started":"2017-01-24T00:00:00.000Z","estimated":"2017-01-30T00:00:00.000Z","delivered":"2017-02-04T00:00:00.000Z"},
  {"started":"2017-02-04T00:00:00.000Z","estimated":"2017-02-11T00:00:00.000Z","delivered":"2017-02-16T00:00:00.000Z"},
  {"started":"2017-02-16T00:00:00.000Z","estimated":"2017-02-20T00:00:00.000Z","delivered":"2017-02-24T00:00:00.000Z"},
  {"started":"2017-02-24T00:00:00.000Z","estimated":"2017-03-01T00:00:00.000Z","delivered":"2017-03-05T00:00:00.000Z"},
  {"started":"2017-03-05T00:00:00.000Z","estimated":"2017-03-12T00:00:00.000Z","delivered":"2017-03-13T00:00:00.000Z"},
  {"started":"2017-03-13T00:00:00.000Z","estimated":"2017-03-20T00:00:00.000Z","delivered":"2017-03-22T00:00:00.000Z"},
  {"started":"2017-03-22T00:00:00.000Z","estimated":"2017-03-27T00:00:00.000Z","delivered":"2017-03-30T00:00:00.000Z"},
  {"started":"2017-03-30T00:00:00.000Z","estimated":"2017-04-06T00:00:00.000Z","delivered":"2017-04-09T00:00:00.000Z"},
  {"started":"2017-04-09T00:00:00.000Z","estimated":"2017-04-15T00:00:00.000Z","delivered":"2017-04-20T00:00:00.000Z"},
  {"started":"2017-04-20T00:00:00.000Z","estimated":"2017-04-23T00:00:00.000Z","delivered":"2017-04-23T00:00:00.000Z"},
  {"started":"2017-04-23T00:00:00.000Z","estimated":"2017-04-30T00:00:00.000Z","delivered":"2017-05-04T00:00:00.000Z"},
  {"started":"2017-05-04T00:00:00.000Z","estimated":"2017-05-09T00:00:00.000Z","delivered":"2017-05-13T00:00:00.000Z"},
  {"started":"2017-05-13T00:00:00.000Z","estimated":"2017-05-16T00:00:00.000Z","delivered":"2017-05-17T00:00:00.000Z"},
  {"started":"2017-05-17T00:00:00.000Z","estimated":"2017-05-20T00:00:00.000Z","delivered":"2017-05-23T00:00:00.000Z"},
  {"started":"2017-05-23T00:00:00.000Z","estimated":"2017-05-28T00:00:00.000Z","delivered":"2017-05-29T00:00:00.000Z"},
  {"started":"2017-05-29T00:00:00.000Z","estimated":"2017-06-02T00:00:00.000Z","delivered":"2017-06-04T00:00:00.000Z"},
  {"started":"2017-06-04T00:00:00.000Z","estimated":"2017-06-07T00:00:00.000Z","delivered":"2017-06-08T00:00:00.000Z"},
  {"started":"2017-06-08T00:00:00.000Z","estimated":"2017-06-15T00:00:00.000Z","delivered":"2017-06-16T00:00:00.000Z"},
  {"started":"2017-06-16T00:00:00.000Z","estimated":"2017-06-20T00:00:00.000Z","delivered":"2017-06-21T00:00:00.000Z"},
  {"started":"2017-06-21T00:00:00.000Z","estimated":"2017-06-25T00:00:00.000Z","delivered":"2017-06-29T00:00:00.000Z"},
  {"started":"2017-06-29T00:00:00.000Z","estimated":"2017-07-03T00:00:00.000Z","delivered":"2017-07-04T00:00:00.000Z"},
  {"started":"2017-07-04T00:00:00.000Z","estimated":"2017-07-07T00:00:00.000Z","delivered":"2017-07-10T00:00:00.000Z"},
  {"started":"2017-07-10T00:00:00.000Z","estimated":"2017-07-14T00:00:00.000Z","delivered":"2017-07-17T00:00:00.000Z"},
  {"started":"2017-07-17T00:00:00.000Z","estimated":"2017-07-22T00:00:00.000Z","delivered":"2017-07-27T00:00:00.000Z"},
  {"started":"2017-07-27T00:00:00.000Z","estimated":"2017-08-01T00:00:00.000Z","delivered":"2017-08-05T00:00:00.000Z"},
  {"started":"2017-08-05T00:00:00.000Z","estimated":"2017-08-09T00:00:00.000Z","delivered":"2017-08-10T00:00:00.000Z"},
  {"started":"2017-08-10T00:00:00.000Z","estimated":"2017-08-14T00:00:00.000Z","delivered":"2017-08-18T00:00:00.000Z"},
  {"started":"2017-08-18T00:00:00.000Z","estimated":"2017-08-25T00:00:00.000Z","delivered":"2017-08-31T00:00:00.000Z"}
];


var dates = data.map(function(el) {
  var timeStarted = new Date(el.started).getTime();
  var timeEstimated = new Date(el.estimated).getTime();
  var timeDelivered = new Date(el.delivered).getTime();

  var extra = timeDelivered - timeEstimated;
  var estimated = timeEstimated - timeStarted;

  return parseInt(((estimated + extra) / (estimated)) * 100 - 100, 10);
})

var results = {};
var resultsArray = ['Individual'];
var average = 0;

var reduced = dates.forEach(function(el) {
  var group = Math.round(el/10);
  results[group] = results[group] ? results[group] + 1 : 1;
})


for (var x = 0; x <= 10; x++) {
  if (results[x]) {
    resultsArray.push(results[x]);
    average += results[x];
  } else {
    resultsArray.push(0);
  }
}
console.warn('total', average);

average = parseInt((average / 1100) * 100, 10);

var resultsArray2 = resultsArray.map(function(el, index) {
  if (index === 0) return 'Smoothed';
  if (index === 1) return el;
  if (index === 11) return el;
  return parseInt( (resultsArray[index-1] + resultsArray[index] + resultsArray[index+1]) / .3, 10) / 10;
});

var resultsArray3 = ['Average'];

for (var x = 1; x < 12; x++) {
  resultsArray3.push(average);
}

console.warn(average);

var chart = c3.generate({
    bindto: '#chart',
    data: {
      columns: [
        resultsArray,
        resultsArray2,
        resultsArray3
      ],
      types: {
        Individual: 'bar',
        Smoothed: 'spline',
        Average: 'line'
      }
    }
});

console.log(results);


</script>
</body>
</html>
